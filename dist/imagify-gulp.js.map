{"version":3,"sources":["../src/imagify-gulp.js"],"names":["ImagifyGulp","settings","buffer_size","lib_url","lib","default_thumb","images","images_ids","Object","keys","total_images","length","processed_images","inprocess_images","_before","Function","_each","_done","_error","total_original_size","total_optimized_size","total_gain","total_percent","global_original_size","global_optimized_size","global_gain","global_percent","context","fnc","bytes","sizes","i","parseInt","Math","floor","log","pow","toFixed","cpt","id","shift","process","data","image_id","toString","substr","image_src","filename","split","pop","thumbnail","error","createThumb","self","image","Image","onerror","data_before","send","onload","maxWidth","maxHeight","imageWidth","width","imageHeight","height","ratio","newHeight","newWidth","canvas","ctx","document","createElement","getContext","drawImage","toDataURL","e","before_data","src","transport","XMLHttpRequest","err","json","response","onreadystatechange","readyState","JSON","parse","responseText","success","progress","json_data","original_size","new_size","original_overall_size","new_overall_size","overall_saving","original_size_human","humanSize","new_size_human","percent","thumbnails","overall_saving_human","original_overall_size_human","tmp_global_percent","global_original_size_human","global_gain_human","open","setRequestHeader"],"mappings":"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","file":"imagify-gulp.js","sourcesContent":["'use strict'\n\nclass ImagifyGulp {\n\n\tconstructor (settings) {\n\t\tthis.buffer_size           = settings.buffer_size || 1\n\t\tthis.lib_url               = settings.lib\n\t\tthis.default_thumb         = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAIAAACRuyQOAAACy0lEQVRIx+1XS1PTUBTuT/MB1NGF3bhyhys3Pv+Ai8pCF6Bb3bsWq8xAh8441I2TSlKwPIKQJsI40IbSV0pJ6qe3OeZ1b9PaYViQyaJzc+757j3nO985TVx5v3o+b+IS6XyQUgtrj/NqWtJmZf3lavnpl53bC2vjRLqRUV4pxqbZcnrBx3F6G2ZzTjFg879IMwWtanV7g56K1Z2RtBGRpj7IWb0a8HhqOz9O2rjHfrOD34GvWcPEruGQkhmlcFgnF7bjABVJmvA4uj4vY2VJr545/yClw/okBywaadF/m63j1gT/sNO5DbXW8t4sLtJzSQtnAme/ys/BrU9FpdIgY2R3MBLidtQ+ZRt2T9qZvQrtf/N9X5BwbEQKmSVIFGZjEGlWNojB93KbCBolDNl49nVPAIYwUs5QGAOQwCtmuuyGG5ExGhZbtM7s+5+3BGC5nyazhB8RElSAePRwRaX1u9nScadfVYjtncV1HtKDlW0KQMqvID4kCAydHST2fgKhu24B7dTaSY4oYBf2MjN44yK9+FZmRnrdCnuhr3jyB7Vr89G8L9f7oU77VSPhp4POjNarzUgv77Z/ERh+R9oUXbqDXFyktFtJ5ag74cU9cBsCwy3DNoht5Fcf0pO8ysuTt27IFzKH/Hm/Qopi5ekP99zzgkU8goF7VN21ThfM9BKHylHEPbzoQ8wUlSGoG1QVnR3Vhppj66hCtgg/Ayr3tdLXCFQ7al4ABr2gAEBHoCbQFDu+RkCvqPVBx5LCZvq2dEDsgELuDqV7rM/SfvmocfNjkYcEdV8Kdcu4Wh6QLzzoPQKtQ9DQvQL9ZYhOiCYteXougo/9UEIv9YHxKK+iZ9qenouE8QIunCMMMzxHYIIomU2ksBOaI5ZHmCO8OavEnI0K2hjmvTnevPe3bjBlTvKvMsoMi4kVAgO/qBXMGvidGu8Me/lf4yIg/QYbLcmjDg4bKwAAAABJRU5ErkJggg==\"\n\t\tthis.images                = settings.images\n\t\tthis.images_ids            = Object.keys( settings.images )\n\t\tthis.total_images          = this.images_ids.length\n\t\tthis.processed_images      = 0\n\t\tthis.inprocess_images      = 0\n\t\tthis._before               = new Function\n\t\tthis._each                 = new Function\n\t\tthis._done                 = new Function\n\t\tthis._error                = new Function\n\t\tthis.total_original_size   = 0\n\t\tthis.total_optimized_size  = 0\n\t\tthis.total_gain            = 0\n\t\tthis.total_percent         = 0\n\t\tthis.global_original_size  = 0\n\t\tthis.global_optimized_size = 0\n\t\tthis.global_gain           = 0\n\t\tthis.global_percent        = 0\n\t\tthis.context               = settings.context || 'wp'\n\t}\n\n\tbefore (fnc) {\n\t\tthis._before = fnc\n\t\treturn this\n\t}\n\n\teach (fnc) {\n\t\tthis._each = fnc\n\t\treturn this\n\t}\n\n\tdone (fnc) {\n\t\tthis._done = fnc\n\t\treturn this\n\t}\n\n\terror (fnc) {\n\t\tthis._error = fnc\n\t\treturn this\n\t}\n\n\thumanSize (bytes) {\n\t\tif ( bytes == 0 ) return '0kb'\n\n\t\tlet\n\t\t\tsizes = ['b', 'kb', 'mb']\n\t\t\t, i   = parseInt( Math.floor( Math.log(bytes) / Math.log(1024) ) )\n\n\t\treturn ( bytes / Math.pow(1024, i) ).toFixed(2) + sizes[i]\n\t}\n\n\trun () {\n\t\tlet cpt = this.images_ids.length > this.buffer_size ? this.buffer_size : this.images_ids.length\n\n\t\tfor ( let i = 0; i < cpt; i++ ) {\n\t\t\tlet id = this.images_ids.shift()\n\t\t\tthis.process(id)\n\t\t}\n\n\t\treturn this\n\t}\n\n\tstopProcess () {\n\t\tthis.total_images = this.total_images - this.images_ids.length;\n\t\tthis.images_ids   = [];\n\t\treturn this\n\t}\n\n\tprocess (id) {\n\t\tthis.inprocess_images++\n\n\t\tlet data = {\n\t\t\tid: id,\n\t\t\timage_id: parseInt( id.toString().substr(1) ),\n\t\t\timage_src: this.images[id],\n\t\t\tfilename: this.images[id].split('/').pop(),\n\t\t\tthumbnail: this.default_thumb,\n\t\t\terror: ''\n\t\t}\n\n\t\tthis.createThumb(data)\n\t}\n\n\tcreateThumb (data) {\n\t\tlet\n\t\t\tself    = this\n\t\t\t, image = new Image\n\n\t\timage.onerror = function () {\n\t\t\tlet data_before = data\n\t\t\tdata_before.id  = data.image_id\n\n\t\t\tself._before(data_before)\n\t\t\tself.send(data)\n\t\t}\n\n\t\timage.onload = function () {\n\t\t\tlet\n\t\t\t\tmaxWidth      = 33\n\t\t\t\t, maxHeight   = 33\n\t\t\t\t, imageWidth  = image.width\n\t\t\t\t, imageHeight = image.height\n\t\t\t\t, ratio       = 1\n\t\t\t\t, newHeight   = 0\n\t\t\t\t, newWidth    = 0\n\t\t\t\t, canvas      = null\n\t\t\t\t, ctx         = null\n\n\t\t\tif ( imageWidth < imageHeight ) {\n\t\t\t\tratio     = maxWidth / imageWidth\n\t\t\t\tnewWidth  = maxWidth\n\t\t\t\tnewHeight = imageHeight * ratio\n\t\t\t} else {\n\t\t\t\tratio     = maxHeight / imageHeight\n\t\t\t\tnewHeight = maxHeight\n\t\t\t\tnewWidth  = imageWidth * ratio\n\t\t\t}\n\n\t\t\tcanvas = document.createElement('canvas')\n\n\t\t\tcanvas.width  = newWidth;\n\t\t\tcanvas.height = newHeight;\n\t\t\timage.width   = newWidth;\n\t\t\timage.height  = newHeight;\n\n\t\t\tctx = canvas.getContext('2d')\n\t\t\tctx.drawImage( this, 0, 0, newWidth, newHeight )\n\n\t\t\ttry {\n\t\t\t\tdata.thumbnail = canvas.toDataURL('image/jpeg')\n\t\t\t} catch (e) {\n\t\t\t\tdata.thumbnail = self.default_thumb\n\t\t\t}\n\n\t\t\tlet before_data = data\n\t\t\tbefore_data.id  = data.image_id\n\n\t\t\tself._before(before_data)\n\n\t\t\tself.send(data)\n\n\t\t\tcanvas = null\n\t\t}\n\n\t\timage.src = data.image_src\n\t}\n\n\tsend (data) {\n\n\t\tlet\n\t\t\tself        = this\n\t\t\t, transport = new XMLHttpRequest\n\t\t\t, err       = false\n\t\t\t, json      = {}\n\t\t\t, response  = {\n\t\t\t\tfilename: data.filename,\n\t\t\t\timage: data.image_id,\n\t\t\t\terror: ''\n\t\t\t}\n\n\t\ttransport.onreadystatechange = function () {\n\t\t\tif ( this.readyState === 4 ) {\n\n\t\t\t\tself.processed_images++\n\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse( this.responseText )\n\t\t\t\t\terr = false\n\t\t\t\t} catch (e) {\n\n\t\t\t\t\tresponse.success = false\n\t\t\t\t\tresponse.error   = 'Unknown error occured'\n\n\t\t\t\t\terr = true\n\n\t\t\t\t}\n\n\t\t\t\tresponse.progress = Math.floor( ( self.processed_images / self.total_images ) * 100 )\n\n\t\t\t\tif ( !err ) {\n\t\t\t\t\tlet json_data = json.data\n\n\t\t\t\t\tresponse.success = json.success\n\n\t\t\t\t\tif ( json.success === true ) {\n\n\t\t\t\t\t\tself.total_original_size   += json_data.original_size\n\t\t\t\t\t\tself.total_optimized_size  += json_data.new_size\n\t\t\t\t\t\tself.total_gain            += ( json_data.original_size - json_data.new_size )\n\t\t\t\t\t\tself.total_percent          = ( (self.total_optimized_size / self.total_original_size) * 100 ).toFixed(2)\n\t\t\t\t\t\tself.global_original_size  += json_data.original_overall_size\n\t\t\t\t\t\tself.global_optimized_size += json_data.new_overall_size\n\t\t\t\t\t\tself.global_gain           += json_data.overall_saving\n\t\t\t\t\t\tself.global_percent         = (100 - ((self.global_optimized_size / self.global_optimized_size) * 100)).toFixed(2)\n\n\t\t\t\t\t\tresponse.original_size       = json_data.original_size\n\t\t\t\t\t\tresponse.original_size_human = self.humanSize(json_data.original_size)\n\n\t\t\t\t\t\tresponse.new_size       = json_data.new_size\n\t\t\t\t\t\tresponse.new_size_human = self.humanSize(json_data.new_size)\n\n\t\t\t\t\t\tresponse.percent    = json_data.percent\n\t\t\t\t\t\tresponse.thumbnails = json_data.thumbnails\n\n\t\t\t\t\t\tresponse.overall_saving       = json_data.overall_saving\n\t\t\t\t\t\tresponse.overall_saving_human = self.humanSize(json_data.overall_saving)\n\n\t\t\t\t\t\tresponse.original_overall_size       = json_data.original_overall_size\n\t\t\t\t\t\tresponse.original_overall_size_human = self.humanSize(json_data.original_overall_size)\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresponse.error = json_data.error\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tself._each(response)\n\n\t\t\t\tif ( self.inprocess_images < self.total_images ) {\n\t\t\t\t\tself.process( self.images_ids.shift() )\n\t\t\t\t}\n\n\t\t\t\tif ( self.processed_images == self.total_images ) {\n\n\t\t\t\t\tlet tmp_global_percent = 0\n\n\t\t\t\t\tif ( self.global_original_size != 0 ) {\n\t\t\t\t\t\ttmp_global_percent = ( ( 100 - ( 100 * ( self.global_optimized_size / self.global_original_size ) ) ).toFixed(2) )\n\t\t\t\t\t}\n\n\t\t\t\t\tself._done({\n\t\t\t\t\t\tglobal_original_size_human : self.humanSize( self.global_original_size ),\n\t\t\t\t\t\tglobal_gain_human          : self.humanSize( self.global_gain ),\n\t\t\t\t\t\tglobal_percent             : tmp_global_percent\n\t\t\t\t\t})\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttransport.open( 'POST', this.lib_url, true )\n\t\ttransport.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' )\n\t\ttransport.send( 'image=' + data.image_id + '&context=' + this.context )\n\t}\n}\n"]}