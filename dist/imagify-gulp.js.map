{"version":3,"sources":["../src/imagify-gulp.js"],"names":[],"mappings":"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","file":"imagify-gulp.js","sourcesContent":["'use strict'\n\nclass ImagifyGulp {\n\n\tconstructor (settings) {\n\t\tthis.buffer_size           = 5\n\t\tthis.lib_url               = settings.lib\n\t\tthis.default_thumb         = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAIAAACRuyQOAAACy0lEQVRIx+1XS1PTUBTuT/MB1NGF3bhyhys3Pv+Ai8pCF6Bb3bsWq8xAh8441I2TSlKwPIKQJsI40IbSV0pJ6qe3OeZ1b9PaYViQyaJzc+757j3nO985TVx5v3o+b+IS6XyQUgtrj/NqWtJmZf3lavnpl53bC2vjRLqRUV4pxqbZcnrBx3F6G2ZzTjFg879IMwWtanV7g56K1Z2RtBGRpj7IWb0a8HhqOz9O2rjHfrOD34GvWcPEruGQkhmlcFgnF7bjABVJmvA4uj4vY2VJr545/yClw/okBywaadF/m63j1gT/sNO5DbXW8t4sLtJzSQtnAme/ys/BrU9FpdIgY2R3MBLidtQ+ZRt2T9qZvQrtf/N9X5BwbEQKmSVIFGZjEGlWNojB93KbCBolDNl49nVPAIYwUs5QGAOQwCtmuuyGG5ExGhZbtM7s+5+3BGC5nyazhB8RElSAePRwRaX1u9nScadfVYjtncV1HtKDlW0KQMqvID4kCAydHST2fgKhu24B7dTaSY4oYBf2MjN44yK9+FZmRnrdCnuhr3jyB7Vr89G8L9f7oU77VSPhp4POjNarzUgv77Z/ERh+R9oUXbqDXFyktFtJ5ag74cU9cBsCwy3DNoht5Fcf0pO8ysuTt27IFzKH/Hm/Qopi5ekP99zzgkU8goF7VN21ThfM9BKHylHEPbzoQ8wUlSGoG1QVnR3Vhppj66hCtgg/Ayr3tdLXCFQ7al4ABr2gAEBHoCbQFDu+RkCvqPVBx5LCZvq2dEDsgELuDqV7rM/SfvmocfNjkYcEdV8Kdcu4Wh6QLzzoPQKtQ9DQvQL9ZYhOiCYteXougo/9UEIv9YHxKK+iZ9qenouE8QIunCMMMzxHYIIomU2ksBOaI5ZHmCO8OavEnI0K2hjmvTnevPe3bjBlTvKvMsoMi4kVAgO/qBXMGvidGu8Me/lf4yIg/QYbLcmjDg4bKwAAAABJRU5ErkJggg==\"\n\t\tthis.images                = settings.images\n\t\tthis.images_ids            = Object.keys( settings.images )\n\t\tthis.total_images          = this.images_ids.length\n\t\tthis.processed_images      = 0\n\t\tthis._before               = new Function\n\t\tthis._each                 = new Function\n\t\tthis._done                 = new Function\n\t\tthis._error                = new Function\n\t\tthis.total_original_size   = 0\n\t\tthis.total_optimized_size  = 0\n\t\tthis.total_gain            = 0\n\t\tthis.total_percent         = 0\n\t\tthis.global_original_size  = 0\n\t\tthis.global_optimized_size = 0\n\t\tthis.global_gain           = 0\n\t\tthis.global_percent        = 0\n\t}\n\n\tbefore (fnc) {\n\t\tthis._before = fnc\n\t}\n\n\teach (fnc) {\n\t\tthis._each = fnc\n\t}\n\n\tdone (fnc) {\n\t\tthis._done = fnc\n\t}\n\n\terror (fnc) {\n\t\tthis._error = fnc\n\t}\n\n\thumanSize (bytes) {\n\t\tif ( bytes == 0 ) return '0kb'\n\t\t\n\t\tlet\n\t\t\tsizes = ['b', 'kb', 'mb']\n\t\t\t, i   = parseInt( Math.floor( Math.log(bytes) / Math.log(1024) ) )\n\t\t\n\t\treturn ( bytes / Math.pow(1024, i) ).toFixed(2) + sizes[i]\n\t}\n\n\trun () {\n\t\tlet cpt = this.images_ids.length > this.buffer_size ? this.buffer_size : this.images_ids.length\n\n\t\tfor ( let i = 0; i <= cpt; i++ ) {\n\t\t\tlet id = this.images_ids.shift()\n\t\t\tthis.process(id)\n\t\t}\n\t}\n\n\tprocess (id) {\n\t\tlet data = {\n\t\t\tid: id,\n\t\t\timage_id: parseInt( id.toString().substr(1) ),\n\t\t\timage_src: this.images[id],\n\t\t\timage_name: this.images[id].split('/').pop()\n\t\t}\n\t\t\n\t\tthis.createThumb(data)\n\t}\n\n\tcreateThumb (data) {\n\t\tlet\n\t\t\tself    = this\n\t\t\t, image = new Image\n\n\t\timage.onerror = function () {\n\t\t\tdata.thumbnail = self.default_thumbhumb\n\t\t\tself._before(data)\n\t\t\tself.send(data)\n\t\t}\n\n\t\timage.onload = function () {\n\t\t\tlet \n\t\t\t\tmaxWidth      = 33\n\t\t\t\t, maxHeight   = 33\n\t\t\t\t, imageWidth  = image.width\n\t\t\t\t, imageHeight = image.height\n\t\t\t\t, ratio       = 1\n\t\t\t\t, newHeight   = 0\n\t\t\t\t, newWidth    = 0\n\t\t\t\t, canvas      = null\n\n\t\t\tif ( imageWidth < imageHeight ) {\n\t\t\t\tratio     = maxWidth / imageWidth\n\t\t\t\tnewWidth  = maxWidth\n\t\t\t\tnewHeight = imageHeight * ratio\n\t\t\t} else {\n\t\t\t\tratio     = maxHeight / imageHeight\n\t\t\t\tnewHeight = maxHeight\n\t\t\t\tnewWidth  = imageWidth * ratio\n\t\t\t}\n\n\t\t\tcanvas = document.createElement('canvas')\n\t\t\t\n\t\t\tcanvas.width  = newWidth;\n\t\t\tcanvas.height = newHeight;\n\t\t\timage.width   = newWidth;\n\t\t\timage.height  = newHeight;\n\t\t\t\n\t\t\tctx = canvas.getContext('2d')\n\t\t\tctx.drawImage( this, 0, 0, newWidth, newHeight )\n\n\t\t\ttry {\n\t\t\t\tdata.thumbnail = canvas.toDataURL('image/jpeg')\n\t\t\t} catch (e) {\n\t\t\t\tdata.thumbnail = self.default_thumb\n\t\t\t}\n\n\t\t\tself._before(data)\n\n\t\t\tself.send(data)\n\n\t\t\tcanvas = null\n\t\t}\n\n\t\timage.src = data.image_src\n\t}\n\n\tsend (data) {\n\t\tlet \n\t\t\tself        = this\n\t\t\t, transport = new XMLHttpRequest\n\t\t\t, err       = false\n\t\t\t, json      = {}\n\t\t\t, response  = {\n\t\t\t\tprogress: Math.floor( (self.processed_images + 1) / self.total_images ),\n\t\t\t\timage: data.id\n\t\t\t}\n\n\t\ttransport.onreadystatechange = function () {\n\t\t\tif ( this.readyState === 4 ) {\n\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse( this.responseText )\n\t\t\t\t\terr = false\n\t\t\t\t} catch (e) {\n\n\t\t\t\t\tresponse = {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: 'An error occured'\n\t\t\t\t\t}\n\n\t\t\t\t\terr = true\n\n\t\t\t\t}\n\n\t\t\t\tif (!err) {\n\t\t\t\t\tlet json_data = json.data\n\n\t\t\t\t\tresponse = {\n\t\t\t\t\t\tsuccess: json.success\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( json.success === true ) {\n\n\t\t\t\t\t\tself.total_original_size   += json_data.original_size\n\t\t\t\t\t\tself.total_optimized_size  += json_data.new_size\n\t\t\t\t\t\tself.total_gain            += ( json_data.original_size - json_data.new_size )\n\t\t\t\t\t\tself.total_percent          = ( (self.total_optimized_size / self.total_original_size) * 100 ).toFixed(2)\n\t\t\t\t\t\tself.global_original_size  += json_data.original_overall_size\n\t\t\t\t\t\tself.global_optimized_size += json_data.new_overall_size\n\t\t\t\t\t\tself.global_gain           += json_data.overall_saving\n\t\t\t\t\t\tself.global_percent         = (100 - ((self.global_optimized_size / self.global_optimized_size) * 100)).toFixed(2)\n\n\t\t\t\t\t\tresponse.original_size_human   = self.humanSize(json_data.original_size)\n\t\t\t\t\t\tresponse.new_size_human        = self.humanSize(json_data.new_size)\n\t\t\t\t\t\tresponse.percent               =  (100 - ((json_data.new_size / json_data.original_size) * 100)).toFixed(2)\n\t\t\t\t\t\tresponse.thumbnails            = json_data.thumbnails\n\t\t\t\t\t\tresponse.overall_saving        = json_data.overall_saving\n\t\t\t\t\t\tresponse.original_overall_size = json_data.original_overall_size\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresponse.error = json_data.error\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tself._each(response)\n\n\t\t\t\tdelete self.images[ data.image_id ]\n\n\t\t\t\tif ( self.images_ids.length > 0 ) {\n\n\t\t\t\t\tself.process( self.images_ids.shift() )\n\n\t\t\t\t} else {\n\n\t\t\t\t\tlet tmp_global_percent = 0\n\t\t\t\t\t\n\t\t\t\t\tif ( self.global_original_size != 0 ) {\n\t\t\t\t\t\ttmp_global_percent = ( ( 100 - ( 100 * ( self.global_optimized_size / self.global_original_size ) ) ).toFixed(2) )\n\t\t\t\t\t}\n\n\t\t\t\t\tself._done({\n\t\t\t\t\t\tglobal_original_size_human : self.humanSize( self.global_original_size ),\n\t\t\t\t\t\tglobal_gain_human          : self.humanSize( self.global_gain ),\n\t\t\t\t\t\tglobal_percent             : tmp_global_percent\n\t\t\t\t\t})\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttransport.open( 'POST', this.lib_url, true )\n\t\ttransport.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' )\n\t\ttransport.send( 'image=' + data.id )\n\t}\n}"]}