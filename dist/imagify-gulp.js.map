{"version":3,"sources":["../src/imagify-gulp.js"],"names":[],"mappings":"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","file":"imagify-gulp.js","sourcesContent":["'use strict'\n\nclass ImagifyGulp {\n\n\tconstructor (settings) {\n\t\tthis.buffer_size           = 1\n\t\tthis.lib_url               = settings.lib\n\t\tthis.default_thumb         = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACMAAAAjCAIAAACRuyQOAAACy0lEQVRIx+1XS1PTUBTuT/MB1NGF3bhyhys3Pv+Ai8pCF6Bb3bsWq8xAh8441I2TSlKwPIKQJsI40IbSV0pJ6qe3OeZ1b9PaYViQyaJzc+757j3nO985TVx5v3o+b+IS6XyQUgtrj/NqWtJmZf3lavnpl53bC2vjRLqRUV4pxqbZcnrBx3F6G2ZzTjFg879IMwWtanV7g56K1Z2RtBGRpj7IWb0a8HhqOz9O2rjHfrOD34GvWcPEruGQkhmlcFgnF7bjABVJmvA4uj4vY2VJr545/yClw/okBywaadF/m63j1gT/sNO5DbXW8t4sLtJzSQtnAme/ys/BrU9FpdIgY2R3MBLidtQ+ZRt2T9qZvQrtf/N9X5BwbEQKmSVIFGZjEGlWNojB93KbCBolDNl49nVPAIYwUs5QGAOQwCtmuuyGG5ExGhZbtM7s+5+3BGC5nyazhB8RElSAePRwRaX1u9nScadfVYjtncV1HtKDlW0KQMqvID4kCAydHST2fgKhu24B7dTaSY4oYBf2MjN44yK9+FZmRnrdCnuhr3jyB7Vr89G8L9f7oU77VSPhp4POjNarzUgv77Z/ERh+R9oUXbqDXFyktFtJ5ag74cU9cBsCwy3DNoht5Fcf0pO8ysuTt27IFzKH/Hm/Qopi5ekP99zzgkU8goF7VN21ThfM9BKHylHEPbzoQ8wUlSGoG1QVnR3Vhppj66hCtgg/Ayr3tdLXCFQ7al4ABr2gAEBHoCbQFDu+RkCvqPVBx5LCZvq2dEDsgELuDqV7rM/SfvmocfNjkYcEdV8Kdcu4Wh6QLzzoPQKtQ9DQvQL9ZYhOiCYteXougo/9UEIv9YHxKK+iZ9qenouE8QIunCMMMzxHYIIomU2ksBOaI5ZHmCO8OavEnI0K2hjmvTnevPe3bjBlTvKvMsoMi4kVAgO/qBXMGvidGu8Me/lf4yIg/QYbLcmjDg4bKwAAAABJRU5ErkJggg==\"\n\t\tthis.images                = settings.images\n\t\tthis.images_ids            = Object.keys( settings.images )\n\t\tthis.total_images          = this.images_ids.length\n\t\tthis.processed_images      = 0\n\t\tthis._before               = new Function\n\t\tthis._each                 = new Function\n\t\tthis._done                 = new Function\n\t\tthis._error                = new Function\n\t\tthis.total_original_size   = 0\n\t\tthis.total_optimized_size  = 0\n\t\tthis.total_gain            = 0\n\t\tthis.total_percent         = 0\n\t\tthis.global_original_size  = 0\n\t\tthis.global_optimized_size = 0\n\t\tthis.global_gain           = 0\n\t\tthis.global_percent        = 0\n\t}\n\n\tbefore (fnc) {\n\t\tthis._before = fnc\n\t\treturn this\n\t}\n\n\teach (fnc) {\n\t\tthis._each = fnc\n\t\treturn this\n\t}\n\n\tdone (fnc) {\n\t\tthis._done = fnc\n\t\treturn this\n\t}\n\n\terror (fnc) {\n\t\tthis._error = fnc\n\t\treturn this\n\t}\n\n\thumanSize (bytes) {\n\t\tif ( bytes == 0 ) return '0kb'\n\t\t\n\t\tlet\n\t\t\tsizes = ['b', 'kb', 'mb']\n\t\t\t, i   = parseInt( Math.floor( Math.log(bytes) / Math.log(1024) ) )\n\t\t\n\t\treturn ( bytes / Math.pow(1024, i) ).toFixed(2) + sizes[i]\n\t}\n\n\trun () {\n\t\tlet cpt = this.images_ids.length > this.buffer_size ? this.buffer_size : this.images_ids.length\n\n\t\tfor ( let i = 0; i <= cpt; i++ ) {\n\t\t\tlet id = this.images_ids.shift()\n\t\t\tthis.process(id)\n\t\t}\n\n\t\treturn this\n\t}\n\n\tprocess (id) {\n\t\tlet data = {\n\t\t\tid: id,\n\t\t\timage_id: parseInt( id.toString().substr(1) ),\n\t\t\timage_src: this.images[id],\n\t\t\tfilename: this.images[id].split('/').pop(),\n\t\t\tthumbnail: this.default_thumbhumb,\n\t\t\terror: ''\n\t\t}\n\t\t\n\t\tthis.createThumb(data)\n\t}\n\n\tcreateThumb (data) {\n\t\tlet\n\t\t\tself    = this\n\t\t\t, image = new Image\n\n\t\timage.onerror = function () {\n\t\t\tself._before(data)\n\t\t\tself.send(data)\n\t\t}\n\n\t\timage.onload = function () {\n\t\t\tlet \n\t\t\t\tmaxWidth      = 33\n\t\t\t\t, maxHeight   = 33\n\t\t\t\t, imageWidth  = image.width\n\t\t\t\t, imageHeight = image.height\n\t\t\t\t, ratio       = 1\n\t\t\t\t, newHeight   = 0\n\t\t\t\t, newWidth    = 0\n\t\t\t\t, canvas      = null\n\t\t\t\t, ctx         = null\n\n\t\t\tif ( imageWidth < imageHeight ) {\n\t\t\t\tratio     = maxWidth / imageWidth\n\t\t\t\tnewWidth  = maxWidth\n\t\t\t\tnewHeight = imageHeight * ratio\n\t\t\t} else {\n\t\t\t\tratio     = maxHeight / imageHeight\n\t\t\t\tnewHeight = maxHeight\n\t\t\t\tnewWidth  = imageWidth * ratio\n\t\t\t}\n\n\t\t\tcanvas = document.createElement('canvas')\n\t\t\t\n\t\t\tcanvas.width  = newWidth;\n\t\t\tcanvas.height = newHeight;\n\t\t\timage.width   = newWidth;\n\t\t\timage.height  = newHeight;\n\t\t\t\n\t\t\tctx = canvas.getContext('2d')\n\t\t\tctx.drawImage( this, 0, 0, newWidth, newHeight )\n\n\t\t\ttry {\n\t\t\t\tdata.thumbnail = canvas.toDataURL('image/jpeg')\n\t\t\t} catch (e) {\n\t\t\t\tdata.thumbnail = self.default_thumb\n\t\t\t}\n\n\t\t\tself._before(data)\n\n\t\t\tself.send(data)\n\n\t\t\tcanvas = null\n\t\t}\n\n\t\timage.src = data.image_src\n\t}\n\n\tsend (data) {\n\n\t\tlet \n\t\t\tself        = this\n\t\t\t, transport = new XMLHttpRequest\n\t\t\t, err       = false\n\t\t\t, json      = {}\n\t\t\t, response  = {\n\t\t\t\tfilename: data.filename,\n\t\t\t\timage: data.id\n\t\t\t}\n\n\t\ttransport.onreadystatechange = function () {\n\t\t\tif ( this.readyState === 4 ) {\n\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse( this.responseText )\n\t\t\t\t\terr = false\n\t\t\t\t} catch (e) {\n\n\t\t\t\t\tresponse.success = false\n\t\t\t\t\tresponse.error   = 'Unknown error occured'\n\n\t\t\t\t\terr = true\n\n\t\t\t\t}\n\n\t\t\t\tself.processed_images++\n\t\t\t\tresponse.progress = Math.floor( ( self.processed_images / self.total_images ) * 100 )\n\n\t\t\t\tif ( !err ) {\n\t\t\t\t\tlet json_data = json.data\n\n\t\t\t\t\tresponse.success = json.success\n\n\t\t\t\t\tif ( json.success === true ) {\n\n\t\t\t\t\t\tself.total_original_size   += json_data.original_size\n\t\t\t\t\t\tself.total_optimized_size  += json_data.new_size\n\t\t\t\t\t\tself.total_gain            += ( json_data.original_size - json_data.new_size )\n\t\t\t\t\t\tself.total_percent          = ( (self.total_optimized_size / self.total_original_size) * 100 ).toFixed(2)\n\t\t\t\t\t\tself.global_original_size  += json_data.original_overall_size\n\t\t\t\t\t\tself.global_optimized_size += json_data.new_overall_size\n\t\t\t\t\t\tself.global_gain           += json_data.overall_saving\n\t\t\t\t\t\tself.global_percent         = (100 - ((self.global_optimized_size / self.global_optimized_size) * 100)).toFixed(2)\n\n\t\t\t\t\t\tresponse.original_size         = json_data.original_size\n\t\t\t\t\t\tresponse.original_size_human   = self.humanSize(json_data.original_size)\n\t\t\t\t\t\t\n\t\t\t\t\t\tresponse.new_size              = json_data.new_size\n\t\t\t\t\t\tresponse.new_size_human        = self.humanSize(json_data.new_size)\n\t\t\t\t\t\t\n\t\t\t\t\t\t//response.percent               =  (100 - ((json_data.new_size / json_data.original_size) * 100)).toFixed(2)\n\t\t\t\t\t\tresponse.percent               = json_data.percent\n\t\t\t\t\t\tresponse.thumbnails            = json_data.thumbnails\n\t\t\t\t\t\tresponse.overall_saving        = json_data.overall_saving\n\t\t\t\t\t\tresponse.original_overall_size = json_data.original_overall_size\n\t\t\t\t\t\t\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresponse.error = json_data.error\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\tself._each(response)\n\n\t\t\t\tdelete self.images[ data.id ]\n\n\t\t\t\tif ( self.images_ids.length > 0 ) {\n\n\t\t\t\t\tself.process( self.images_ids.shift() )\n\n\t\t\t\t} else {\n\n\t\t\t\t\tlet tmp_global_percent = 0\n\t\t\t\t\t\n\t\t\t\t\tif ( self.global_original_size != 0 ) {\n\t\t\t\t\t\ttmp_global_percent = ( ( 100 - ( 100 * ( self.global_optimized_size / self.global_original_size ) ) ).toFixed(2) )\n\t\t\t\t\t}\n\n\t\t\t\t\tself._done({\n\t\t\t\t\t\tglobal_original_size_human : self.humanSize( self.global_original_size ),\n\t\t\t\t\t\tglobal_gain_human          : self.humanSize( self.global_gain ),\n\t\t\t\t\t\tglobal_percent             : tmp_global_percent\n\t\t\t\t\t})\n\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttransport.open( 'POST', this.lib_url, true )\n\t\ttransport.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded' )\n\t\ttransport.send( 'image=' + data.id )\n\t}\n}"]}